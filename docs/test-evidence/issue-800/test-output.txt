
> roastr-ai@1.0.0 test
> jest --verbose tests/integration/multi-tenant-rls-issue-800.test.js

  console.log
    [dotenv@17.2.3] injecting env (42) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.info
    ğŸ“‹ Tenant A: ef33284d-086d-4abd-88d2-b5517492cc8e

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:56:13)

  console.info
    ğŸ“‹ Tenant B: 318531c3-acbd-4772-8f01-7655c5c6c06a

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:57:13)

  console.info
    
    ğŸ“Š RLS Test Coverage:

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:263:15)

  console.info
       Baseline (issue #412): 6 tables

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:264:15)

  console.info
       Expansion (issue #800): 5 tables

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:265:15)

  console.info
       Total: 11/22 (50.0%)

      at Object.info (tests/integration/multi-tenant-rls-issue-800.test.js:266:15)

  console.info
    âœ… Cleanup complete

      at Object.info (tests/setupIntegration.js:49:15)

PASS integration-tests tests/integration/multi-tenant-rls-issue-800.test.js (5.067 s)
  Multi-Tenant RLS Integration Tests - Issue #800 (5 Additional Tables)
    Setup Verification
      âœ“ Setup creates 2 tenants with test data in 5 additional tables (2 ms)
    AC1: Service Role Data Access - Organization-Scoped Tables (3 tables)
      âœ“ Service role can access app_logs from both tenants (239 ms)
      âœ“ Service role can access api_keys from both tenants (SECURITY CRITICAL) (81 ms)
      âœ“ Service role can access audit_logs from both tenants (AUDIT CRITICAL) (80 ms)
    AC2: Service Role Data Access - User-Scoped Tables (2 tables)
      âœ“ Service role can access account_deletion_requests from both users (GDPR CRITICAL) (69 ms)
      âœ“ Service role can access password_history from both users (SECURITY CRITICAL) (65 ms)
    AC3: Anon Client RLS Enforcement - Organization-Scoped Tables (3 tables)
      âœ“ Anon client returns empty for app_logs (RLS blocks) (72 ms)
      âœ“ Anon client returns empty for api_keys (RLS blocks - SECURITY) (77 ms)
      âœ“ Anon client returns empty for audit_logs (RLS blocks - AUDIT) (112 ms)
    AC4: Anon Client RLS Enforcement - User-Scoped Tables (2 tables)
      âœ“ Anon client returns empty for account_deletion_requests (RLS blocks - GDPR) (68 ms)
      âœ“ Anon client returns empty for password_history (RLS blocks - SECURITY) (76 ms)
    Coverage Statistics
      âœ“ Count total tables tested (baseline + expansion) (2 ms)

Test Suites: 1 passed, 1 total
Tests:       12 passed, 12 total
Snapshots:   0 total
Time:        5.15 s
Ran all test suites matching tests/integration/multi-tenant-rls-issue-800.test.js.
