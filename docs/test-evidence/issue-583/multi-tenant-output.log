
> roastr-ai@1.0.0 test
> jest --verbose tests/integration/multi-tenant-rls-issue-412.test.js

  console.log
    [dotenv@17.2.3] injecting env (42) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL integration-tests tests/integration/multi-tenant-rls-issue-412.test.js
  Multi-Tenant RLS Integration Tests - Issue #412
    Setup Verification
      âœ• Setup creates 2 tenants with isolated data
    AC1: Listados restringidos por tenant_id
      âœ• GET /posts returns only Tenant A posts
      âœ• GET /comments returns only Tenant A comments (1 ms)
      âœ• GET /roasts returns only Tenant A roasts
    AC2: Accesos directos por ID verifican tenant_id
      âœ• GET /posts/:id returns 200 for own tenant
      âœ• GET /posts/:id returns null for other tenant
      âœ• GET /comments/:id returns 200 for own tenant
      âœ• GET /comments/:id returns null for other tenant
      âœ• GET /roasts/:id returns 200 for own tenant
      âœ• GET /roasts/:id returns null for other tenant
    AC3: Accesos cruzados devuelven 404/forbidden
      âœ• Tenant A cannot read Tenant B posts
      âœ• Tenant A cannot read Tenant B comments
      âœ• Tenant A cannot read Tenant B roasts
    RLS Context Verification
      âœ• getTenantContext returns current tenant ID

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º Setup Verification â€º Setup creates 2 tenants with isolated data

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC1: Listados restringidos por tenant_id â€º GET /posts returns only Tenant A posts

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC1: Listados restringidos por tenant_id â€º GET /comments returns only Tenant A comments

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC1: Listados restringidos por tenant_id â€º GET /roasts returns only Tenant A roasts

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /posts/:id returns 200 for own tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /posts/:id returns null for other tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /comments/:id returns 200 for own tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /comments/:id returns null for other tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /roasts/:id returns 200 for own tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC2: Accesos directos por ID verifican tenant_id â€º GET /roasts/:id returns null for other tenant

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC3: Accesos cruzados devuelven 404/forbidden â€º Tenant A cannot read Tenant B posts

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC3: Accesos cruzados devuelven 404/forbidden â€º Tenant A cannot read Tenant B comments

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º AC3: Accesos cruzados devuelven 404/forbidden â€º Tenant A cannot read Tenant B roasts

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

  â— Multi-Tenant RLS Integration Tests - Issue #412 â€º RLS Context Verification â€º getTenantContext returns current tenant ID

    Failed to create comments: null value in column "original_text" of relation "comments" violates not-null constraint

      203 |       .select();
      204 |
    > 205 |     if (error) throw new Error(`Failed to create comments: ${error.message}`);
          |                      ^
      206 |     testData.comments = data;
      207 |     logger.debug(`  âœ… Created ${data.length} comments`);
      208 |   }

      at createTestData (tests/helpers/tenantTestUtils.js:205:22)
      at Object.<anonymous> (tests/integration/multi-tenant-rls-issue-412.test.js:33:19)

Test Suites: 1 failed, 1 total
Tests:       14 failed, 14 total
Snapshots:   0 total
Time:        2.737 s, estimated 12 s
Ran all test suites matching tests/integration/multi-tenant-rls-issue-412.test.js.
