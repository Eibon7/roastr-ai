
> roastr-ai@1.0.0 test
> jest --verbose tests/unit/utils/textNormalizer.test.js

PASS node-tests tests/unit/utils/textNormalizer.test.js
  textNormalizer
    normalizeUnicode
      âœ“ should normalize "cafÃ©" to NFC: Composed form (Ã© as single character) (1 ms)
      âœ“ should normalize "cafÃ©" to NFD: Decomposed form (Ã© as e + combining accent)
      âœ“ should normalize "Ã…" to NFC: Latin capital A with ring above (composed)
      âœ“ should normalize "Ã…" to NFD: Latin capital A with ring above (decomposed)
      âœ“ should normalize "â‘ â‘¡â‘¢" to NFKC: Circled numbers to ASCII
      âœ“ should normalize "ï¬le" to NFKC: Ligature to separate letters (1 ms)
      âœ“ should normalize "ğŸ”¥" to NFC: Emoji normalization
      âœ“ should normalize "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" to NFC: Family emoji with ZWJ
      âœ“ should handle empty string
      âœ“ should handle non-string input (1 ms)
      âœ“ should throw error for invalid normalization form (8 ms)
      âœ“ should handle combining characters
      âœ“ should handle multiple combining marks
      âœ“ should produce consistent results for repeated normalization
      âœ“ should normalize large text efficiently
    sanitizeUrl
      âœ“ should accept Valid HTTPS URL: "https://example.com"
      âœ“ should accept Valid HTTP URL with path: "http://example.com/path" (1 ms)
      âœ“ should reject XSS javascript protocol: "javascript:alert(1)"
      âœ“ should reject XSS data protocol: "data:text/html,<script>alert(1)</script>"
      âœ“ should reject XSS vbscript protocol: "vbscript:msgbox(1)"
      âœ“ should reject File protocol (security risk): "file:///etc/passwd"
      âœ“ should reject FTP protocol (not allowed by default): "ftp://example.com"
      âœ“ should reject Malformed URL: "not-a-url"
      âœ“ should reject Protocol-relative URL (missing protocol): "//example.com"
      âœ“ should handle empty string
      âœ“ should handle whitespace-only string
      âœ“ should handle null and undefined
      âœ“ should handle non-string input
      âœ“ should remove query params when option is set
      âœ“ should remove fragment when option is set
      âœ“ should allow custom protocols
      âœ“ should handle URLs with special characters
      âœ“ should handle international domain names
      âœ“ should produce same result when sanitized twice
      âœ“ should sanitize URLs efficiently (1 ms)
    normalizeQuotes
      âœ“ should normalize Smart double quotes to straight
      âœ“ should normalize Smart single quotes to straight
      âœ“ should normalize Low-9 quote to straight
      âœ“ should normalize Double low-9 quote to straight
      âœ“ should normalize Prime marks to straight quotes (1 ms)
      âœ“ should normalize Straight to smart double quotes
      âœ“ should normalize Straight to smart single quotes
      âœ“ should handle empty string
      âœ“ should handle string without quotes
      âœ“ should handle non-string input
      âœ“ should handle nested quotes
      âœ“ should handle mixed quote types
      âœ“ should produce consistent results
      âœ“ should normalize large text with many quotes efficiently
    normalizeSpaces
      âœ“ should Trim leading/trailing spaces (1 ms)
      âœ“ should Collapse multiple spaces
      âœ“ should Collapse multiple tabs
      âœ“ should Remove non-breaking spaces
      âœ“ should Normalize CRLF to LF
      âœ“ should Normalize CR to LF
      âœ“ should Keep leading/trailing with trim=false (but still collapse) (1 ms)
      âœ“ should Keep multiple spaces with collapseMultiple=false
      âœ“ should handle empty string
      âœ“ should handle string with only spaces
      âœ“ should handle non-string input
      âœ“ should handle various whitespace types
      âœ“ should preserve regular spaces when not collapsing
      âœ“ should produce consistent results
      âœ“ should normalize large text efficiently (1 ms)
    normalizeText (combined)
      âœ“ should apply all normalizations by default
      âœ“ should handle unicode + quotes + spaces together
      âœ“ should allow selective normalization
      âœ“ should handle non-string input gracefully
      âœ“ should produce same result when normalized multiple times
      âœ“ should normalize large complex text efficiently
    Integration scenarios
      âœ“ should normalize user input for database storage
      âœ“ should sanitize URL while normalizing surrounding text
      âœ“ should handle mixed content with unicode, quotes, and spaces
    Security edge cases
      âœ“ should not break on malicious unicode sequences (2 ms)
      âœ“ should reject URLs with XSS attempts
      âœ“ should block blob: URLs (can contain malicious content)
      âœ“ should block filesystem: URLs (filesystem access)
      âœ“ should block jar: URLs (Java Archive protocol)
      âœ“ should block chrome: URLs (browser internal)
      âœ“ should block chrome-extension: URLs (extension URIs)
      âœ“ should block view-source: URLs (can nest dangerous protocols) (1 ms)
      âœ“ should block percent-encoded javascript: protocol (obfuscation bypass)
      âœ“ should block percent-encoded dangerous protocols
      âœ“ should handle extremely long input without crashing (1 ms)
      âœ“ should handle text with zero-width characters

Test Suites: 1 passed, 1 total
Tests:       85 passed, 85 total
Snapshots:   0 total
Time:        0.564 s, estimated 1 s
Ran all test suites matching tests/unit/utils/textNormalizer.test.js.
