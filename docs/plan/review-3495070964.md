# CodeRabbit Review #3495070964 - Plan

## Análisis

- **Critical:** 0
- **Major:** 2 - UX/Error Handling
- **Minor:** 1 - Data Normalization

### Issues Detallados

| Archivo | Línea | Tipo | Impacto | Root Cause |
|---------|-------|------|---------|------------|
| `frontend/src/pages/dashboard.jsx` | 339-364 | Major | User Experience | Missing error feedback for roast actions (regenerate, discard, publish) |
| `frontend/src/pages/StyleProfile.jsx` | 58-73 | Major | Access Control | Using `available` instead of `hasAccess` flag for access gating |
| `frontend/src/pages/StyleProfile.jsx` | 118-136 | Minor | Data Consistency | Profile data normalization inconsistent with GET endpoint |

## GDD

- **Nodos:** persona, plan-features, multi-tenant, observability
- **Actualizar:** Ninguno (cambios son fixes de bugs, no cambios arquitecturales)
- **"Agentes Relevantes":** Ya actualizado en issue #910

## Agentes

### Invocar:
- ✅ **FrontendDev**: Cambios en componentes React (dashboard.jsx, StyleProfile.jsx)
- ⚠️ **TestEngineer**: SKIP - Tests ya cubiertos en issue #910, estos son fixes menores

### Receipts:
- `docs/agents/receipts/cursor-frontend-review-3495070964.md`

### SKIP Justification:
- **TestEngineer**: Los tests unitarios de API services ya cubren el flujo. Estos fixes son de UI error handling y no requieren nuevos tests (solo mejorar UX).
- **Guardian**: No hay cambios de seguridad ni políticas RLS.
- **TaskAssessor**: Solo 3 fixes menores, no requiere assessment completo.

## Archivos

### Mencionados:
- `frontend/src/pages/dashboard.jsx` (líneas 339-364)
- `frontend/src/pages/StyleProfile.jsx` (líneas 58-73, 118-136)

### Dependientes:
- `frontend/src/api/integrations.js` (usado por StyleProfile)
- `frontend/src/api/roast.js` (usado por dashboard)
- `frontend/src/services/apiClient.js` (usado por ambos)

### Tests:
- Unit: `frontend/src/api/__tests__/integrations.test.js` (verificar que no se rompa)
- Unit: `frontend/src/api/__tests__/roast.test.js` (verificar que no se rompa)
- Manual: Verificar UX en navegador (error messages displaying)

## Estrategia

### Orden de Aplicación:
1. **Fix #1 (Major):** StyleProfile.jsx líneas 58-73 - Access gating flag
2. **Fix #2 (Minor):** StyleProfile.jsx líneas 118-136 - Data normalization
3. **Fix #3 (Major):** dashboard.jsx líneas 339-364 - Error feedback

### Commits:
- Commit único: "fix(frontend): Apply CodeRabbit review - error handling & data normalization"

### Tests a Ejecutar:
```bash
# Unit tests
cd frontend && npx craco test --testPathPattern="src/api/__tests__" --watchAll=false

# Build verification
cd frontend && npm run build

# Full test suite
npm test

# Coverage
npm run test:coverage
```

## Éxito

- [ ] 100% resuelto (3/3 comentarios CodeRabbit)
- [ ] Tests: 0 failures
- [ ] Coverage: ≥90% (mantener 85%+)
- [ ] GDD health ≥87 (actualmente 90.2)
- [ ] CodeRabbit: 0 comentarios pendientes
- [ ] Build passing
- [ ] Manual verification: Error messages display correctly

## Patrones Conocidos

### Pattern Match:
- **Pattern #8: Error Handling Resilience** (docs/patterns/coderabbit-lessons.md)
  - dashboard.jsx issue matches: Silent failures sin user feedback
  - Aplicar: User-facing error messages con `setConnectionStatus`

### Actualizar Lessons:
- ❌ NO (solo 1 ocurrencia, threshold es ≥2 para pattern)
- Si se repite en otra PR → añadir patrón "Silent Error Handling in UI"

## Detalles de Implementación

### Fix #1: Access Gating Flag
```javascript
// BEFORE:
setHasAccess(available);

// AFTER:
setHasAccess(hasAccessFlag);
```

### Fix #2: Data Normalization
```javascript
// BEFORE:
} else if (data.success === true || data.data?.success === true) {
  setProfileData(data);
  setSelectedLanguage(data.profiles?.[0]?.lang || null);
}

// AFTER:
} else if (data.success === true || data.data?.success === true) {
  const profile = data.data || data;
  setProfileData(profile);
  setSelectedLanguage(profile.profiles?.[0]?.lang || null);
}
```

### Fix #3: Error Feedback (3 functions)
```javascript
// Pattern para handleRegenerateRoast, handleDiscardRoast, handlePublishRoast:
catch (error) {
  console.error('Error <action> roast:', error);
  setConnectionStatus({
    type: 'error',
    message: 'Error al <action> el roast. Por favor, intenta de nuevo.'
  });
  setTimeout(() => setConnectionStatus(null), 5000);
}
```

## Referencias

- CodeRabbit Review: https://github.com/Eibon7/roastr-ai/pull/918#pullrequestreview-3495070964
- Issue Original: #910
- PR: #918
- Nodos GDD: persona.md, plan-features.md

---

**Status:** PLANNED ✅  
**Next:** Aplicar fixes (FASE 2)

