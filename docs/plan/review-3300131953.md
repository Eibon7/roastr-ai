# Plan de Implementación - CodeRabbit Review #3300131953

**Fecha**: 2025-10-03
**PR**: #447 - Reconcile roast limits in spec.md
**Tipo**: Corrección de inconsistencias remanentes en límites de roasts

## Resumen del Problema

A pesar de la actualización anterior, CodeRabbit detectó **archivos adicionales** que aún contienen valores desactualizados de límites de roasts. Específicamente:

- Algunos archivos tienen Free = 50 o 100 roasts (debe ser 10)
- Algunos archivos tienen Starter = 100 roasts (debe ser 10)

**Valores Oficiales (repetimos para claridad):**
```
Free: 100 análisis, 10 roasts
Starter: 1,000 análisis, 10 roasts
Pro: 10,000 análisis, 1,000 roasts
Plus: 100,000 análisis, 5,000 roasts
```

## Comentarios de CodeRabbit a Abordar

### 1. src/services/planService.js
**Línea 28**: Free tier `roastsPerMonth` debe cambiar de 50 a **10**
**Línea 54**: Starter tier `roastsPerMonth` debe cambiar de 100 a **10**

### 2. src/routes/plan.js
**Línea 13**: Free tier `roastsPerMonth` debe cambiar de 100 a **10**
**Línea 25**: Starter tier `roastsPerMonth` debe cambiar de 100 a **10**

### 3. src/services/costControl.js
**Línea 899**: Free tier monthly roasts debe cambiar de 100 a **10**

### 4. src/routes/billing.js
**Línea 60**: Texto marketing debe cambiar de "50 roasts per month" a "**10 roasts per month**"

## Subagentes a Utilizar

1. **Back-end Dev Agent** - Actualizar archivos de configuración y servicios
2. **Test Engineer Agent** - Verificar que no hay regresiones y que todos los tests pasan

## Estrategia de Implementación

### Fase 1: Auditoría Completa
- Buscar TODOS los archivos con valores hardcodeados de roasts
- Crear lista completa de archivos a modificar
- Priorizar por impacto (servicios core > rutas > helpers)

### Fase 2: Actualización Back-end
**Back-end Dev Agent** realizará:
1. `src/services/planService.js` - Actualizar definiciones de planes
2. `src/routes/plan.js` - Actualizar endpoints de planes
3. `src/services/costControl.js` - Actualizar límites de control de costos
4. `src/routes/billing.js` - Actualizar texto de marketing

### Fase 3: Verificación
**Test Engineer Agent** realizará:
1. Ejecutar suite completa de tests
2. Verificar que no hay valores hardcodeados adicionales
3. Generar reporte de cobertura

### Fase 4: Documentación
- Actualizar `spec.md` si es necesario (verificar que ya esté correcto)
- Documentar cambios en changelog de PR

## Archivos Afectados

### Configuración y Servicios
- `src/services/planService.js` ⚠️ CRÍTICO
- `src/routes/plan.js` ⚠️ CRÍTICO
- `src/services/costControl.js` ⚠️ CRÍTICO
- `src/routes/billing.js` (marketing copy)

### Tests (si necesario)
- Tests relacionados con planService
- Tests relacionados con costControl
- Tests de integración de billing

### Documentación
- `docs/plan/review-3300131953.md` (este archivo)
- Changelog de PR #447

## Criterios de Éxito

- ✅ Todos los archivos tienen Free = 10 roasts
- ✅ Todos los archivos tienen Starter = 10 roasts
- ✅ Todos los archivos tienen Pro = 1000 roasts
- ✅ Todos los archivos tienen Plus = 5000 roasts
- ✅ No quedan valores hardcodeados inconsistentes
- ✅ Todos los tests pasando
- ✅ spec.md alineado con implementación
- ✅ CodeRabbit satisfecho

## Riesgos y Mitigaciones

**Riesgo**: Pueden existir más archivos con valores hardcodeados no detectados
**Mitigación**: Hacer grep exhaustivo en todo el código fuente antes de finalizar

**Riesgo**: Tests pueden fallar si esperan valores antiguos
**Mitigación**: Test Engineer Agent actualizará expects según sea necesario

## Notas Adicionales

- Esta es la **segunda iteración** de corrección de límites
- La primera iteración actualizó tierConfig.js, entitlementsService.js, y otros
- Esta iteración cubre archivos que fueron omitidos en la primera pasada
- Necesitamos un enfoque más sistemático para evitar futuras inconsistencias
- **Sugerencia post-implementación**: Considerar centralizar TODOS los límites en tierConfig.js y eliminar duplicación
