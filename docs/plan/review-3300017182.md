# Plan de Implementación - CodeRabbit Review #3300017182

**Fecha**: 2025-10-03
**PR**: #447 - Reconcile roast limits in spec.md
**Tipo**: Alineación spec.md ↔ implementación

## Resumen del Problema

CodeRabbit detectó inconsistencia crítica entre `spec.md` (actualizado con valores oficiales) y la implementación real en el código. Específicamente:

- **spec.md** dice: Starter = 100 roasts/mes
- **tierConfig.js** dice: Starter = 100 roasts/mes ✅ (ya está correcto)
- **Pero CodeRabbit pide cambiar a 10 roasts** ❓

**⚠️ CONFLICTO DETECTADO**: Los valores oficiales proporcionados por el usuario son:
```
Free: 100 análisis, 10 roasts
Starter: 1,000 análisis, 100 roasts  ← Este es el valor oficial
Pro: 10,000 análisis, 1,000 roasts
Plus: 100,000 análisis, 5,000 roasts
```

CodeRabbit sugiere cambiar Starter de 100 a 10 roasts, pero esto **contradice** los valores oficiales del usuario.

## Decisión

**MANTENER** los valores oficiales del usuario (Starter = 100 roasts), ya que:
1. El usuario proporcionó los valores oficiales explícitamente
2. tierConfig.js ya está alineado con estos valores
3. Los tests ya están alineados con estos valores
4. Esta PR ya resolvió la reconciliación según los valores oficiales

## Acciones a Realizar

### 1. Verificación Completa de Consistencia
**Agente**: Back-end Dev
**Archivos a revisar**:
- `src/config/tierConfig.js` - Verificar valores actuales
- `src/services/entitlementsService.js` - Verificar lógica de límites
- `src/services/creditsService.js` - Verificar cálculos de créditos
- `src/services/planService.js` - Verificar definiciones de planes
- `src/routes/plan.js` - Verificar endpoints de planes
- `src/services/costControl.js` - Verificar controles de costos

**Criterio de éxito**:
- Todos los archivos tienen **Starter = 100 roasts, 1000 análisis**
- Todos los archivos tienen **Free = 10 roasts, 100 análisis**
- Todos los archivos tienen **Pro = 1000 roasts, 10000 análisis**
- Todos los archivos tienen **Plus = 5000 roasts, 100000 análisis**

### 2. Verificación y Actualización de Tests
**Agente**: Test Engineer
**Archivos**:
- `tests/unit/services/entitlementsService.test.js`
- `tests/integration/entitlementsFlow.test.js`
- Cualquier otro test relacionado con límites de planes

**Acciones**:
- Verificar que todos los expects usen valores oficiales
- Actualizar cualquier test que use valores antiguos
- Ejecutar suite completa de tests
- Generar evidencia de tests pasando

### 3. Actualización de Documentación
**Agente**: Documentation (yo mismo como orquestador)
**Archivos**:
- `spec.md` - Verificar que refleja valores oficiales
- `docs/plan/review-3300017182.md` - Este archivo
- Changelog de la PR

## Subagentes a Utilizar

1. **Back-end Dev Agent** - Verificación y actualización de configuración y servicios
2. **Test Engineer Agent** - Verificación y actualización de tests + evidencias

## Criterios de Éxito

- ✅ Todos los archivos de configuración alineados con valores oficiales del usuario
- ✅ Todos los tests pasando con valores oficiales
- ✅ spec.md refleja valores oficiales
- ✅ No hay hardcoded values inconsistentes en el código
- ✅ CodeRabbit satisfecho o decisión documentada si hay desacuerdo justificado

## Archivos Afectados

### Configuración
- `src/config/tierConfig.js`
- `src/services/entitlementsService.js`
- `src/services/creditsService.js`
- `src/services/planService.js`
- `src/routes/plan.js`
- `src/services/costControl.js`

### Tests
- `tests/unit/services/entitlementsService.test.js`
- `tests/integration/entitlementsFlow.test.js`

### Documentación
- `spec.md`
- `docs/plan/review-3300017182.md`

## Notas

- Esta PR originalmente reconcilió spec.md con valores oficiales
- CodeRabbit puede estar comparando contra valores antiguos
- Mantener valores oficiales del usuario como fuente de verdad
- Documentar cualquier discrepancia con CodeRabbit
