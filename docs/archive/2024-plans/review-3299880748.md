# Plan de Implementación - CodeRabbit Review #3299880748

**Fecha**: 2025-10-03
**PR**: #447 - Reconcile roast limits in spec.md
**Review URL**: https://github.com/Eibon7/roastr-ai/pull/447#pullrequestreview-3299880748

## Resumen Ejecutivo

CodeRabbit detectó inconsistencias en los límites de roast entre tests y configuración. Además, hay problemas de formato en documentación de agentes.

## Comentarios de CodeRabbit a Abordar

### 1. Markdown Formatting Issues

**Archivo**: `.claude/agents/back-end-dev.md`

- **Problema**: Indentación incorrecta en listas y headings
- **Acción**: Remover espacios iniciales, alinear a columna 0
- **Criticidad**: LOW (cosmético)

### 2. Test Inconsistencies - entitlementsService.test.js

**Archivo**: `tests/unit/services/entitlementsService.test.js`

- **Problema 1**: Test de Starter plan espera `roast_limit_monthly: 100` pero debería ser basado en valores oficiales
- **Problema 2**: Test de Free/default tier espera roast usage pero el valor puede estar desactualizado
- **Acción**: Actualizar expects para coincidir con valores oficiales del usuario
- **Criticidad**: HIGH (tests fallan o son incorrectos)

### 3. Configuration Mismatch - tierConfig.js

**Archivo**: `src/config/tierConfig.js`
**Línea**: DEFAULT_TIER_LIMITS.starter

- **Problema**: `maxRoasts: 50` y `monthlyResponsesLimit: 50`
- **Debe ser**: `maxRoasts: 100` y `monthlyResponsesLimit: 100` (según spec oficial Starter)
- **Criticidad**: HIGH (configuración incorrecta)

## Valores Oficiales (Referencia)

Según especificación del usuario:

| Plan    | Analysis | Roasts  |
| ------- | -------- | ------- |
| Free    | 100      | **10**  |
| Starter | 1,000    | **100** |
| Pro     | 10,000   | 1,000   |
| Plus    | 100,000  | 5,000   |

## Subagentes a Utilizar

### 1. Documentation Agent

- **Tarea**: Corregir formato markdown en `.claude/agents/back-end-dev.md`
- **Razón**: Experto en documentación y formato

### 2. Back-end Dev Agent

- **Tarea**: Actualizar `src/config/tierConfig.js` con valores correctos
- **Razón**: Cambios en configuración de backend

### 3. Test Engineer Agent

- **Tarea**: Actualizar `tests/unit/services/entitlementsService.test.js`
- **Razón**: Corrección de tests unitarios

## Archivos Afectados

1. `.claude/agents/back-end-dev.md` - Formato markdown
2. `src/config/tierConfig.js` - Configuración Starter plan
3. `tests/unit/services/entitlementsService.test.js` - Aserciones de tests

## Plan de Implementación

### Fase 1: Documentación (Documentation Agent)

1. Leer `.claude/agents/back-end-dev.md`
2. Identificar líneas con indentación incorrecta
3. Corregir formato markdown (quitar espacios iniciales)
4. Validar con linter markdown

### Fase 2: Configuración (Back-end Dev Agent)

1. Leer `src/config/tierConfig.js`
2. Ubicar `DEFAULT_TIER_LIMITS.starter`
3. Actualizar:
   - `maxRoasts: 50` → `maxRoasts: 100`
   - `monthlyResponsesLimit: 50` → `monthlyResponsesLimit: 100`
4. Verificar no hay otras referencias a límites Starter

### Fase 3: Tests (Test Engineer Agent)

1. Leer `tests/unit/services/entitlementsService.test.js`
2. Identificar tests relacionados con Starter plan
3. Actualizar expects:
   - Roast limits para Starter: 100
   - Verificar Free plan: 10 roasts
4. Ejecutar tests: `npm test tests/unit/services/entitlementsService.test.js`
5. Validar todos los tests pasan

### Fase 4: Validación Final

1. Ejecutar suite completa de tests
2. Verificar `spec.md` está actualizado (debería estar desde commits anteriores)
3. Generar changelog entry

## Criterios de Validación

- [ ] Markdown lint pasa en `.claude/agents/back-end-dev.md`
- [ ] `tierConfig.js` tiene Starter con 100 roasts
- [ ] Tests unitarios de entitlementsService pasan (31/31)
- [ ] Tests de integración pasan (17/17)
- [ ] `spec.md` refleja valores correctos
- [ ] Changelog actualizado con cambios

## Riesgos y Mitigación

**Riesgo**: Tests pueden fallar si hay otras inconsistencias no detectadas
**Mitigación**: Ejecutar suite completa de tests antes de commit

**Riesgo**: Cambios pueden afectar otros tests no identificados
**Mitigación**: Ejecutar `npm test` completo, no solo archivos modificados

## Siguiente Paso

Proceder con implementación usando los 3 agentes especializados en el orden definido.
