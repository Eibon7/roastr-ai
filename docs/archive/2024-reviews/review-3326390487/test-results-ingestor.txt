
> roastr-ai@1.0.0 test
> jest --verbose tests/integration/ingestor-acknowledgment.test.js tests/integration/ingestor-deduplication.test.js tests/integration/ingestor-error-handling.test.js tests/integration/ingestor-mock-test.test.js tests/integration/ingestor-order-processing.test.js tests/integration/ingestor-retry-backoff.test.js

PASS node-tests tests/integration/ingestor-mock-test.test.js
  Ingestor Mock Mode Test
    ✓ should work in mock mode (107 ms)

PASS node-tests tests/integration/ingestor-deduplication.test.js
  Ingestor Deduplication Integration Tests
    Comment ID Deduplication
      ✓ should prevent duplicate comments with same platform_comment_id (109 ms)
      ✓ should handle reprocessing of same comments without duplicates (102 ms)
      ✓ should allow same platform_comment_id across different organizations (1 ms)
      ✓ should handle database constraint violations gracefully (102 ms)
      ✓ should preserve deduplication across multiple fetch operations (102 ms)
    Deduplication Performance
      ✓ should efficiently handle large batches with duplicates (103 ms)

PASS node-tests tests/integration/ingestor-order-processing.test.js
  Ingestor Processing Order Integration Tests
    FIFO Processing Order
      ✓ should process jobs in first-in-first-out order (110 ms)
      ✓ should maintain order across multiple fetch operations (102 ms)
      ✓ should respect priority-based ordering (103 ms)
    Order Preservation with Retries
      ✓ should maintain order when jobs require retries (153 ms)
      ✓ should not block processing when one job permanently fails (257 ms)
    Concurrent Processing Order
      ✓ should maintain order within priority levels during concurrent processing (172 ms)
      ✓ should preserve order across different priority levels with concurrency (312 ms)
    Order Validation Utilities
      ✓ should validate job order using helper assertion (14 ms)

PASS node-tests tests/integration/ingestor-acknowledgment.test.js
  Ingestor Message Acknowledgment Integration Tests
    Successful Job Acknowledgment
      ✓ should acknowledge jobs correctly after successful processing (110 ms)
      ✓ should acknowledge multiple jobs in sequence (102 ms)
      ✓ should preserve acknowledgment across worker restarts (203 ms)
    Failed Job Acknowledgment
      ✓ should properly handle failed job acknowledgment (424 ms)
      ✓ should acknowledge after successful retry (256 ms)
    Acknowledgment Timing and Performance
      ✓ should acknowledge jobs promptly after completion (102 ms)
      ✓ should handle concurrent job acknowledgments correctly (154 ms)
    Acknowledgment Error Handling
      ✓ should handle acknowledgment failures gracefully (102 ms)

PASS node-tests tests/integration/ingestor-error-handling.test.js
  Ingestor Error Handling Integration Tests
    Transient Error Handling
      ✓ should retry transient network errors (464 ms)
      ✓ should handle timeout errors with appropriate retries (406 ms)
      ✓ should handle rate limiting as transient error (256 ms)
      ✓ should differentiate between recoverable and non-recoverable network errors (273 ms)
    Permanent Error Handling
      ✓ should not retry authentication errors (102 ms)
      ✓ should not retry forbidden/permission errors (103 ms)
      ✓ should not retry malformed request errors (102 ms)
      ✓ should not retry resource not found errors (101 ms)
    Error Classification
      ✓ should correctly classify HTTP status codes (734 ms)
      ✓ should handle mixed error scenarios in batch processing (481 ms)
    Error Recovery and State Management
      ✓ should maintain consistent state after error recovery (261 ms)
      ✓ should handle database errors during comment storage (388 ms)
      ✓ should handle partial batch failures gracefully (105 ms)

PASS node-tests tests/integration/ingestor-retry-backoff.test.js (6.964 s)
  Ingestor Retry and Backoff Integration Tests
    Exponential Backoff Retry Logic
      ✓ should implement exponential backoff with correct timing (413 ms)
      ✓ should respect maximum retry attempts (269 ms)
      ✓ should handle queue-level retry with exponential backoff (1 ms)
      ✓ should use different backoff multipliers correctly (858 ms)
    Retry Strategy Differentiation
      ✓ should distinguish between transient and permanent errors (265 ms)
      ✓ should handle rate limiting with appropriate backoff (407 ms)
    Backoff Configuration
      ✓ should respect custom retry delay configuration (709 ms)
      ✓ should handle maximum backoff limits (3368 ms)

Test Suites: 6 passed, 6 total
Tests:       44 passed, 44 total
Snapshots:   0 total
Time:        7.122 s
Ran all test suites matching tests/integration/ingestor-acknowledgment.test.js|tests/integration/ingestor-deduplication.test.js|tests/integration/ingestor-error-handling.test.js|tests/integration/ingestor-mock-test.test.js|tests/integration/ingestor-order-processing.test.js|tests/integration/ingestor-retry-backoff.test.js.
