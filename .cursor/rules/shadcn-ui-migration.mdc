---
description: Reglas para migraci√≥n UI a shadcn/ui y desarrollo frontend de Roastr.AI
globs:
alwaysApply: false
---

# Shadcn/UI Migration & Frontend Development Rules

## üéØ Context
Roastr.AI est√° migrando toda su UI a shadcn/ui para:
- Consistencia visual y UX mejorada
- Tema claro/oscuro/sistema (sistema por defecto)
- Componentes accesibles y testeables
- Reducci√≥n de c√≥digo custom

**Epic Principal:** #1032 - Migraci√≥n UI ‚Üí shadcn/ui
**Documento de referencia:** `docs/plan/ui-migration-github-issues.md`

---

## üìã Usage Rule

### Cu√°ndo usar shadcn components
**SIEMPRE** que se requiera un componente UI:
- ‚úÖ Usar MCP server de shadcn para instalar componentes
- ‚úÖ Verificar disponibilidad en shadcn antes de crear custom
- ‚úÖ Aplicar tema consistente (claro/oscuro/sistema)

### Componentes disponibles
```
button, card, dialog, input, table, switch, tabs, accordion, 
select, dropdown-menu, toast, scroll-area, sheet, checkbox,
progress, badge, avatar, separator, skeleton, alert, calendar,
command, popover, radio-group, slider, textarea, tooltip
```

---

## üß≠ Planning Rule

### Cuando planifiques implementaciones UI relacionadas con shadcn:

1. **Usar MCP server durante planning**
   ```bash
   # Listar componentes disponibles
   /mcp list shadcn-studio
   
   # Ver metadata de componentes
   mcp_shadcn-studio_MCP_get-blocks-metadata
   ```

2. **Aplicar componentes donde sea aplicable**
   - ‚úÖ Preferir bloques completos (login page, dashboard, settings)
   - ‚úÖ Usar componentes individuales para casos espec√≠ficos
   - ‚úÖ Mantener consistencia con Design System

3. **Usar bloques completos cuando sea posible**
   - Login page completo ‚Üí mejor que armar con componentes individuales
   - Dashboard layouts ‚Üí usar templates de shadcn
   - Forms complejos ‚Üí usar bloques de formularios

---

## üé® Shadcn-Studio MCP Commands

### Comandos disponibles para generaci√≥n UI:

| Comando | Prop√≥sito | Cu√°ndo usar |
|---------|-----------|-------------|
| `/cui` | Customize from existing block | Reutilizar estructura de block con contenido custom |
| `/iui` | Generate new, inspired UI (Pro only) | Dise√±os creativos y √∫nicos |
| `/rui` | Refine or edit existing block | Updates o tweaks a blocks existentes |
| `/ftc` | Install blocks from Figma (requires Figma MCP) | Convertir mockups de Figma a c√≥digo |

### 1Ô∏è‚É£ Create UI (`/cui`) - RECOMENDADO para la mayor√≠a de casos

**Usar cuando:** Quieres reutilizar la estructura de un block existente con tu propio contenido.

**Ejemplos para Roastr.AI:**

```bash
# Admin Panel
/cui Create a users table with search, filters and actions for admin panel

/cui Create a metrics dashboard with cards showing analysis count, roast count, and user stats

/cui Create a feature flags configuration table with toggle switches

/cui Create a plans configuration form with limits and checkboxes

# User App
/cui Create a hero section for user dashboard showing monthly usage widgets

/cui Create a social accounts table with connection status and stats

/cui Create a settings page with tabs for Account, Preferences, and Billing

/cui Create a roasts table with approve/reject actions

# Auth
/cui Create a login page with email/password and magic link option
```

**Workflow `/cui`:**
1. Describe lo que necesitas en lenguaje natural
2. MCP encuentra el block m√°s apropiado
3. Genera c√≥digo customizado para tu caso
4. Instala dependencias necesarias
5. C√≥digo listo para usar

**Puedes especificar el block exacto:**
```bash
/cui Create a pricing section for Roastr plans using Pricing 3
```

### 2Ô∏è‚É£ Inspire UI (`/iui`) - Pro Only

**Usar cuando:** Necesitas un dise√±o completamente nuevo y creativo.

**Ejemplos para Roastr.AI:**

```bash
/iui Create a unique roast preview card with toxicity indicators

/iui Design an innovative shield status widget with visual threat levels

/iui Create a creative sponsor configuration interface
```

**‚ö†Ô∏è Nota:** Requiere plan Pro de shadcn-studio.

### 3Ô∏è‚É£ Refine UI (`/rui`)

**Usar cuando:** Necesitas ajustar o mejorar un block ya instalado.

**Ejemplos:**

```bash
/rui Add a search bar to the users table

/rui Change the metrics cards to show percentage instead of absolute numbers

/rui Add dark mode support to the login page

/rui Make the accounts table responsive for mobile
```

**Workflow `/rui`:**
1. Identifica el block a refinar
2. Describe los cambios necesarios
3. MCP genera c√≥digo actualizado
4. Revisa y aplica cambios

### 4Ô∏è‚É£ Figma to Code (`/ftc`) - Requiere Figma MCP

**Usar cuando:** Ya tienes el dise√±o completo en Figma usando Pro/Free Blocks.

**Workflow `/ftc`:**
1. Dise√±a landing page en Figma usando shadcn-studio blocks
2. Ejecuta `/ftc` con link o referencia a dise√±o Figma
3. MCP identifica autom√°ticamente todos los blocks usados
4. Instala todos los blocks en tu codebase
5. C√≥digo listo con estructura id√©ntica a Figma

**Ideal para:**
- Landing pages completas
- Marketing pages
- P√°ginas con muchos bloques diferentes

**‚ö†Ô∏è Requisitos:**
- Figma MCP instalado y configurado
- Dise√±o en Figma debe usar blocks de shadcn-studio

---

## üöÄ Implementation Rule

### Workflow recomendado para cada issue UI:

#### Paso 1: Analizar requerimientos
- Leer Acceptance Criteria de la issue
- Identificar componentes/blocks necesarios
- Decidir comando MCP apropiado

#### Paso 2: Elegir comando MCP

**Para p√°ginas/secciones completas ‚Üí `/cui`**
```bash
# Ejemplo Issue #1038 (Admin users page)
/cui Create a users table with name, email, status columns, search bar, 
     and action buttons for add, edit, delete

# Ejemplo Issue #1044 (User widgets)
/cui Create usage widgets showing monthly consumption with progress bars
```

**Para componentes individuales ‚Üí Componentes shadcn**
```bash
# Instalar componente individual
npx shadcn-ui@latest add button
npx shadcn-ui@latest add dialog
```

**Para refinamientos ‚Üí `/rui`**
```bash
# Cuando necesites ajustar algo ya creado
/rui Add pagination to the users table
/rui Make the form validation more strict
```

**Para dise√±os creativos ‚Üí `/iui` (Pro only)**
```bash
# Cuando necesites algo √∫nico
/iui Create an innovative roast preview with animations
```

#### Paso 3: Implementar

1. **Ejecutar comando MCP elegido**
   - Dejar que MCP genere el c√≥digo base
   - Revisar c√≥digo generado

2. **Customizar para Roastr.AI**
   - Conectar a endpoints reales (`/api/...`)
   - A√±adir l√≥gica de negocio (feature flags, plan visibility)
   - Aplicar tipos TypeScript si aplica

3. **Verificar tema**
   - ‚úÖ Probar en modo claro
   - ‚úÖ Probar en modo oscuro
   - ‚úÖ Verificar que sistema es default

4. **Hacer responsive**
   - ‚úÖ Probar en m√≥vil (375px)
   - ‚úÖ Probar en tablet (768px)
   - ‚úÖ Probar en desktop (1920px)

#### Paso 4: Testing

- [ ] Rendering en diferentes temas
- [ ] Interacciones funcionan
- [ ] Accesibilidad (a11y)
- [ ] Responsive en todos los breakpoints
- [ ] Conectado a API correctamente

#### Paso 5: Documentar

- [ ] Comentar decisiones de dise√±o si aplica
- [ ] Actualizar checklist de issue
- [ ] Generar test evidence si es necesario

---

## üé® Styling Rules

### DO ‚úÖ
```tsx
// Usar componentes shadcn directamente
import { Button } from "@/components/ui/button"
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"

<Card>
  <CardHeader>
    <CardTitle>An√°lisis este mes</CardTitle>
  </CardHeader>
  <CardContent className="flex flex-col gap-4">
    {/* Tailwind solo para layout */}
  </CardContent>
</Card>
```

### DON'T ‚ùå
```tsx
// NO crear componentes custom que shadcn ya provee
const MyCustomButton = styled.button`...` // ‚ùå

// NO a√±adir CSS modules para UI
import styles from './MyCard.module.css' // ‚ùå

// NO hardcodear colores
<div className="bg-blue-500"> // ‚ùå
// Usar variables de tema: bg-primary, bg-secondary, etc.
```

---

## üìÅ File Structure Rules

### Organizaci√≥n de componentes

```
src/
  components/
    ui/                    # shadcn components (generados)
      button.tsx
      card.tsx
      dialog.tsx
      ...
    layout/                # Layout components
      admin-shell.tsx
      app-shell.tsx
      main-nav.tsx
      mobile-nav.tsx
      theme-toggle.tsx
    admin/                 # Admin-specific components
      users-table.tsx
      feature-flags-table.tsx
      metrics-overview.tsx
    app/                   # User app components
      home/
        usage-widgets.tsx
        accounts-table.tsx
      accounts/
        account-header.tsx
        roasts-table.tsx
      settings/
        persona-settings-form.tsx
```

---

## üß™ Testing Rules

### Tests requeridos para componentes UI

1. **Rendering tests**
   ```tsx
   test('renders in light mode', () => {
     render(<Component />, { theme: 'light' })
     expect(screen.getByRole('button')).toBeInTheDocument()
   })
   
   test('renders in dark mode', () => {
     render(<Component />, { theme: 'dark' })
     expect(screen.getByRole('button')).toBeInTheDocument()
   })
   ```

2. **Interaction tests**
   ```tsx
   test('handles user interaction', async () => {
     const onSubmit = jest.fn()
     render(<Form onSubmit={onSubmit} />)
     
     await userEvent.click(screen.getByRole('button'))
     expect(onSubmit).toHaveBeenCalled()
   })
   ```

3. **Accessibility tests**
   - ‚úÖ Verificar roles ARIA
   - ‚úÖ Verificar labels
   - ‚úÖ Verificar navegaci√≥n por teclado

---

## üì± Responsive Rules

### Breakpoints (Tailwind defaults)

```tsx
// Mobile first approach
<div className="
  w-full              // m√≥vil: full width
  md:w-1/2            // tablet: 50%
  lg:w-1/3            // desktop: 33%
">
```

### Navigation adaptativa

```tsx
// Desktop: Sidebar
// Tablet: Collapsed sidebar
// Mobile: Sheet/Drawer

import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"

<Sheet>
  <SheetTrigger asChild>
    <Button variant="ghost" size="icon" className="md:hidden">
      <MenuIcon />
    </Button>
  </SheetTrigger>
  <SheetContent side="left">
    <Navigation />
  </SheetContent>
</Sheet>
```

### Tables en m√≥vil

```tsx
// Opci√≥n 1: Scroll horizontal
<div className="overflow-x-auto">
  <Table />
</div>

// Opci√≥n 2: Convertir a cards en m√≥vil
<div className="hidden md:block">
  <Table />
</div>
<div className="md:hidden">
  <AccountCards />
</div>
```

---

## üîí Security & Best Practices

### Forms

```tsx
// ‚úÖ Usar zod para validaci√≥n
import { z } from "zod"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"

const formSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8)
})

const form = useForm({
  resolver: zodResolver(formSchema)
})
```

### API calls

```tsx
// ‚úÖ Usar capa API centralizada
import { api } from "@/lib/api"

// NO hacer fetch directo
const data = await api.users.list() // ‚úÖ

// NO
const data = await fetch('/api/users') // ‚ùå
```

---

## üé≠ Theme Configuration

### ThemeProvider setup

```tsx
// app/layout.tsx
import { ThemeProvider } from "next-themes"

export default function RootLayout({ children }) {
  return (
    <html lang="es" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  )
}
```

### Theme toggle

```tsx
// components/layout/theme-toggle.tsx
import { useTheme } from "next-themes"
import { Button } from "@/components/ui/button"
import { Moon, Sun, Monitor } from "lucide-react"

export function ThemeToggle() {
  const { theme, setTheme } = useTheme()
  
  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="icon">
          <Sun className="rotate-0 scale-100 dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute rotate-90 scale-0 dark:rotate-0 dark:scale-100" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent>
        <DropdownMenuItem onClick={() => setTheme("light")}>
          Claro
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("dark")}>
          Oscuro
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("system")}>
          Sistema
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}
```

---

## üö´ Migration Rules - What to REMOVE

### Identificar y eliminar progresivamente:

1. **CSS Modules**
   ```bash
   # Buscar archivos a migrar
   find src -name "*.module.css"
   ```

2. **Styled Components**
   ```tsx
   // ‚ùå Eliminar
   const StyledButton = styled.button`...`
   
   // ‚úÖ Reemplazar con
   import { Button } from "@/components/ui/button"
   ```

3. **Componentes UI custom**
   ```tsx
   // ‚ùå Eliminar cuando ya no se use
   src/components/common/Button.tsx
   src/components/common/Card.tsx
   src/components/common/Modal.tsx
   ```

4. **Estilos globales duplicados**
   ```css
   /* src/globals.css - MANTENER SOLO: */
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   
   /* Variables de shadcn theme */
   @layer base {
     :root { /* theme vars */ }
   }
   
   /* ‚ùå ELIMINAR todo lo dem√°s */
   ```

---

## üìä Progress Tracking

### Antes de cerrar una issue:

- [ ] Componente implementado usando comando MCP apropiado (`/cui`, `/rui`, etc.)
- [ ] C√≥digo generado revisado y customizado para Roastr.AI
- [ ] Conectado a endpoints reales de API
- [ ] Probado en claro/oscuro/sistema
- [ ] Responsive en m√≥vil/tablet/desktop
- [ ] Tests pasando (rendering + interaction + a11y)
- [ ] No hay estilos custom duplicando shadcn
- [ ] Capa API usada correctamente
- [ ] Documentaci√≥n actualizada si aplica
- [ ] Screenshots de evidencia (si aplica)

### Command usage tracking

**Documenta qu√© comando usaste:**
```markdown
## Implementation Notes

**Shadcn MCP Command:** `/cui Create a users table...`
**Block used:** `table-with-actions-02` (si es espec√≠fico)
**Customizations:** 
- Connected to /api/admin/users
- Added role-based visibility
- Custom pagination logic
```

---

## üîó References

**Epic Principal:** #1032
**Issues relacionadas:** #1033, #1034, #1035, #1036
**Documento:** `docs/plan/ui-migration-github-issues.md`
**MCP Server:** shadcn-studio
**Design System:** shadcn/ui + Tailwind CSS

---

## ‚ö†Ô∏è Common Pitfalls

### Evitar:

1. **Mixing patterns**
   - NO mezclar shadcn + styled-components en mismo componente
   - NO mezclar CSS modules + Tailwind

2. **Over-customization**
   - NO modificar componentes shadcn si no es necesario
   - Preferir variantes nativas
   - Usar `/rui` para refinamientos en lugar de reescribir

3. **Not using MCP commands**
   - ‚ùå NO crear componentes desde cero si existe un block
   - ‚úÖ SIEMPRE revisar si `/cui` puede generar lo que necesitas
   - ‚úÖ Usar `/rui` para ajustes en lugar de editar manualmente

4. **Wrong command selection**
   - ‚ùå NO usar `/iui` para casos est√°ndar (es Pro y para casos creativos)
   - ‚úÖ Usar `/cui` para 90% de los casos
   - ‚úÖ Guardar `/iui` para componentes realmente √∫nicos

5. **Ignoring generated code**
   - ‚ùå NO ignorar el c√≥digo que MCP genera
   - ‚úÖ Revisar y entender antes de modificar
   - ‚úÖ Hacer cambios incrementales sobre lo generado

6. **Hardcoding theme values**
   - Usar variables CSS: `hsl(var(--primary))`
   - NO usar colores directos: `#3b82f6`

---

## üéì Best Practices con MCP Commands

### 1. Iteration workflow

```bash
# Primera iteraci√≥n - generar base
/cui Create a users table with basic columns

# Segunda iteraci√≥n - refinar
/rui Add search and filters to the users table

# Tercera iteraci√≥n - ajustar
/rui Make the table pagination server-side
```

### 2. Specificity en prompts

**‚ùå Vago:**
```bash
/cui Create a table
```

**‚úÖ Espec√≠fico:**
```bash
/cui Create a users table with columns for name, email, plan, status, 
    a search bar at the top, action buttons for edit/delete, 
    and pagination at the bottom
```

### 3. Reusabilidad

- Primero genera con `/cui`
- Si necesitas el mismo patr√≥n en otro lado, copia y adapta
- Si necesitas muchas variaciones ‚Üí considera crear un block custom

### 4. Documentaci√≥n de decisiones

Siempre documenta en la PR:
- Qu√© comando MCP usaste
- Por qu√© elegiste ese comando
- Qu√© customizaciones hiciste
- Qu√© blocks espec√≠ficos se usaron (si aplica)

---

---

## üéØ Ejemplos Pr√°cticos por Issue

### Issue #1038 - Admin Users Page

**Comando recomendado:**
```bash
/cui Create an admin users table with columns for name, email, user ID, 
    and status (active/inactive). Include a search bar for filtering by 
    name or email, and action buttons for add user (opens dialog), 
    edit user (opens dialog), delete user (with confirmation), 
    and impersonate user.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/admin/users`
- Implementar l√≥gica de impersonation
- A√±adir guards de admin-only

---

### Issue #1044 - User Widgets

**Comando recomendado:**
```bash
/cui Create two usage widgets side by side. First widget shows 
    "An√°lisis este mes" with consumed/available count and a progress bar. 
    Second widget shows "Roasts este mes" with the same structure. 
    Both should use card layout and be responsive.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/usage/current`
- Aplicar colores seg√∫n % de uso (verde <70%, amarillo 70-90%, rojo >90%)
- Formatear n√∫meros con separadores de miles

---

### Issue #1058 - Login Page

**Comando recomendado:**
```bash
/cui Create a centered login page with email and password inputs, 
    a primary login button, and a secondary "Send magic link" button. 
    Include Roastr.AI branding and support for light/dark mode.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/auth/login`
- Implementar redirecci√≥n seg√∫n `isAdmin`
- A√±adir validaci√≥n con zod
- Toast para errores

---

### Issue #1042 - Admin Metrics

**Opci√≥n 1 - Generar todo junto:**
```bash
/cui Create an admin metrics dashboard with cards showing: 
    - Total an√°lisis and roasts
    - Average per user
    - User distribution by plan (Starter/Pro/Plus percentages)
    - Feature usage (persona/sponsor/tone percentages)
    - Cost metrics (avg cost and tokens per analysis/roast)
    Use a grid layout with cards, each showing a title, value, and subtitle.
```

**Opci√≥n 2 - Generar por partes:**
```bash
# Primero las cards de totales
/cui Create metric cards for total analysis, roasts, and active users

# Luego las tablas
/cui Create a table showing user distribution by plan with percentages

# Luego refinar
/rui Add cost metrics section with average cost and tokens
```

---

### Issue #1046 - Accounts Table

**Comando recomendado:**
```bash
/cui Create a clickable accounts table with columns for social network icon, 
    handle, status (active/paused/inactive with badges), roasts count, 
    and shield interceptions count. Each row should be fully clickable 
    to navigate to account detail. Include responsive design for mobile.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/accounts`
- Implementar navegaci√≥n a `/app/accounts/[id]`
- Convertir a cards en m√≥vil
- Iconos por red social (lucide-react o custom)

---

### Issue #1049 - Account Settings Dialog

**Comando recomendado:**
```bash
/cui Create a settings dialog with: a toggle for auto-approve roasts, 
    a legal disclaimer text, a dropdown for Shield level, 
    a dropdown for default tone with preview, and a toggle to pause account. 
    Include save and cancel buttons.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/accounts/:id/settings`
- Implementar preview de roast en tiempo real
- Validaci√≥n de cambios
- Toast de confirmaci√≥n

---

### Issue #1055 - Settings Preferences Tab

**Comando recomendado:**
```bash
/cui Create a settings form with sections for Roastr Persona (bio, tone, 
    preferences fields), a transparency notice, a custom prompt field 
    (conditionally visible), and sponsor configuration fields 
    (conditionally visible). Use proper spacing and grouping.
```

**Customizaciones post-generaci√≥n:**
- Conectar a `/api/persona` y `/api/sponsor`
- Implementar l√≥gica de visibilidad por plan + feature flags
- Validaci√≥n con zod
- Auto-save o bot√≥n de guardar

---

## üé¨ Video Tutorial

**Recomendado ver:** [Shadcn-Studio MCP Tutorial](https://www.youtube.com/watch?v=...)

Cubre:
- Instalaci√≥n de MCP server
- Uso de cada comando
- Best practices
- Troubleshooting com√∫n

---

**√öltima actualizaci√≥n:** 2025-11-26
**Maintainer:** Frontend Team
**Status:** ‚úÖ Active
**MCP Version:** Latest (shadcn-studio)
