# SSOT ENFORCEMENT RULE (Roastr v2)

# Agents MUST treat the following file as the single source of truth:

docs/SSOT-V2.md

# Note: This file exists in the current branch. After PR #1099 merge,

# the path may be updated to docs/roastr-ssot-v2.md if the SSOT structure changes.

## 0. Activation Flow (MANDATORY)

**BEFORE any task, code generation, or implementation:**

Agents MUST execute the following activation flow:

### 0.1 Pre-Task SSOT Verification

1. **Verify SSOT exists and is accessible:**

   ```bash
   test -f docs/SSOT-V2.md && echo "SSOT exists" || echo "SSOT missing"
   ```

2. **Load SSOT file:**
   - Read `docs/SSOT-V2.md` completely
   - Identify relevant sections for the current task
   - Note any TBD markers or incomplete sections

3. **Validate SSOT integrity:**
   - Check for required sections (Plans, Billing, Feature Flags, etc.)
   - Verify no corrupted or malformed content
   - Confirm SSOT version matches expected v2 structure

### 0.2 SSOT Availability Handling

**If SSOT is missing or inaccessible:**

- STOP immediately
- Output: "SSOT file not found. Cannot proceed without SSOT."
- Request SSOT file restoration or creation

**If SSOT is corrupted or incomplete:**

- STOP immediately
- Output: "SSOT integrity check failed. SSOT must be repaired before proceeding."
- Report specific issues found

**If SSOT exists and is valid:**

- Proceed to section 2 (Mandatory Validation Workflow)
- Reference SSOT sections in all subsequent operations

### 0.3 Activation Checklist

Before proceeding with any task, verify:

- [ ] SSOT file exists at `docs/SSOT-V2.md`
- [ ] SSOT is readable and parseable
- [ ] Relevant SSOT sections identified for current task
- [ ] No TBD markers in critical sections for this task
- [ ] SSOT version is v2 (not legacy v1)

**Only proceed if ALL checks pass.**

## 1. Forbidden

Agents MUST NOT:

- invent plans, tiers, pricing, limits or plan features.
- invent feature flags not in SSOT.
- invent platforms, billing providers, OAuth flows or webhooks.
- invent states or transitions for billing or shield.
- invent tones, prompt blocks, config keys or SSOT settings.
- introduce legacy v1 elements unless explicitly migrating them.
- override SSOT-defined behavior without updating SSOT first.

If any violation is detected → STOP and output:
"This requires an SSOT update first."

## 2. Mandatory Validation Workflow

Before implementing or generating code:

1. Load the SSOT file.
2. Identify relevant SSOT sections.
3. Cross-check requested change against SSOT.
4. If mismatch → block with:
   "SSOT mismatch — update SSOT first."
5. If aligned → proceed and reference applied SSOT rules.

## 3. SSOT-First Code Generation

- ALWAYS reference SSOT identifiers.
- NEVER hardcode values in code that belong in SSOT.
- All configurable behavior MUST use SSOT config loader.

## 4. Test Engineer Requirements

- Tests MUST use SSOT constants.
- Block tests that create non-SSOT plan names, flags, or billing states.

## 5. Orchestrator Requirements

- Orchestrator must reject tasks that diverge from SSOT.
- Enforce: "No SSOT update → No behavioral change."

## 6. Spec-Update Skill Integration

If a change contradicts SSOT:
Output:
"This change requires SSOT modification. Please update SSOT first."

## 7. Anti AI-Slop Rule

Generated diffs MUST:

- match existing style,
- avoid noise, defensive boilerplate, and `any` casts,
- resemble human-written code.

## 8. Block Legacy v1 Leakage

Reject:

- v1 plan names,
- Stripe billing,
- legacy platforms (unless migration explicitly requested),
- v1 workers, prompts, or schemas.

Message:
"Legacy v1 reference detected. V2 only allows values defined in SSOT."

## 9. Final Compliance Rule

If SSOT and the task conflict → SSOT wins.  
If SSOT is silent → agent MUST ask for clarification.  
If SSOT is outdated → agent MUST request SSOT update before acting.
