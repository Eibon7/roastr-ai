# 🎭 Mock Mode Guide - Switching Between Mock and Real APIs

## Overview

This project includes a comprehensive mock mode system that allows development and CI/CD without any real API keys. You can easily switch between mock mode and real API mode.

## 🎯 Quick Switch Guide

### Enable Mock Mode (Default for CI/Tests)
```bash
# Backend
export ENABLE_MOCK_MODE=true
npm run test

# Frontend  
export REACT_APP_ENABLE_MOCK_MODE=true
npm run test
```

### Enable Real API Mode (Production)
```bash
# Backend
export ENABLE_MOCK_MODE=false
# Set your real API keys...
export OPENAI_API_KEY=sk-your-real-openai-key
export SUPABASE_URL=https://your-project.supabase.co
export SUPABASE_SERVICE_KEY=your-real-service-key
export STRIPE_SECRET_KEY=sk_live_your-real-stripe-key

# Frontend
export REACT_APP_ENABLE_MOCK_MODE=false  
export REACT_APP_SUPABASE_URL=https://your-project.supabase.co
export REACT_APP_SUPABASE_ANON_KEY=your-real-anon-key
```

## 🔄 Automatic Mock Detection

The system automatically enables mock mode when:

1. `NODE_ENV=test` 
2. `ENABLE_MOCK_MODE=true` (backend) or `REACT_APP_ENABLE_MOCK_MODE=true` (frontend)
3. Required API keys are missing or contain "mock"/"dummy" in their values
4. Supabase URLs contain "mock", "dummy", or "localhost"

## 📁 Environment Files

### Development (.env.development)
```env
# Real APIs for development
ENABLE_MOCK_MODE=false
OPENAI_API_KEY=sk-your-dev-openai-key
SUPABASE_URL=https://your-dev-project.supabase.co
REACT_APP_ENABLE_MOCK_MODE=false
```

### Testing (.env.test) - Already configured
```env
# Complete mock mode for tests
ENABLE_MOCK_MODE=true
OPENAI_API_KEY=mock-openai-key-sk-test123456789
SUPABASE_URL=http://localhost:54321/mock
REACT_APP_ENABLE_MOCK_MODE=true
```

### Production (.env.production)
```env
# Real APIs for production
ENABLE_MOCK_MODE=false
OPENAI_API_KEY=sk-your-production-openai-key
SUPABASE_URL=https://your-production-project.supabase.co
REACT_APP_ENABLE_MOCK_MODE=false
```

## 🛠️ What Gets Mocked

### Backend APIs
- ✅ **OpenAI**: Mock roast generation with placeholder responses
- ✅ **Supabase**: Mock database operations and auth
- ✅ **Stripe**: Mock payment processing and webhooks
- ✅ **Perspective API**: Mock toxicity analysis (always returns low toxicity)
- ✅ **Social Media APIs**: Mock responses for all 9 platforms
  - Twitter, YouTube, Instagram, Facebook, Discord, Twitch, Reddit, TikTok, Bluesky
- ✅ **Style Profile Generation**: Mock AI style analysis and prompt generation

### Frontend APIs
- ✅ **Supabase Client**: Mock auth flows and database operations
- ✅ **Backend APIs**: Mock API endpoints (/api/health, /api/logs, etc.)
- ✅ **External Services**: All fetch calls intercepted with mock responses

## 🔍 Verifying Mock Mode Status

### Backend
```javascript
const { mockMode } = require('./src/config/mockMode');
console.log('Mock mode enabled:', mockMode.isMockMode);
```

### Frontend  
```javascript
import { isMockModeEnabled } from './src/lib/mockMode';
console.log('Mock mode enabled:', isMockModeEnabled());
```

### Environment Logs
Look for these console messages:
- `🎭 Mock Mode ENABLED - Using fake data for all external APIs`
- `🔗 Real Mode ENABLED - Using real API connections`

## 🚀 CI/CD Configuration

Our GitHub Actions workflow automatically uses mock mode:

```yaml
env:
  ENABLE_MOCK_MODE: true
  NODE_ENV: test
  OPENAI_API_KEY: "mock-openai-key-sk-test123456789"
  SUPABASE_URL: "http://localhost:54321/mock"
  REACT_APP_ENABLE_MOCK_MODE: true
  # ... all other keys are mock values
```

## 🔐 Security Notes

- ✅ **No real API keys** are ever committed to the repository
- ✅ **All mock values** are clearly identifiable (contain "mock" or "dummy")
- ✅ **Production keys** should be set via environment variables or secrets management
- ✅ **CI/CD runs completely offline** with no external API calls

## 🧪 Testing in Different Modes

### Run Tests in Mock Mode (Default)
```bash
npm run test:ci
cd frontend && npm run test:ci
```

### Run Tests Against Real APIs (Not Recommended)
```bash
ENABLE_MOCK_MODE=false npm run test
# Requires all real API keys to be set
```

## 📊 Mock Data Examples

### Roast Generation Response
```json
{
  "choices": [
    {
      "message": {
        "content": "🎭 This is a mock roast response! In real mode, this would be a witty comeback generated by OpenAI."
      }
    }
  ]
}
```

### Style Profile Generation (NEW)
```json
{
  "success": true,
  "data": {
    "profiles": [
      {
        "lang": "es",
        "prompt": "Eres un usuario amigable que usa un estilo equilibrado entre brevedad y detalle...",
        "sources": { "twitter": 180, "instagram": 95 },
        "metadata": {
          "totalItems": 275,
          "dominantTone": "friendly",
          "styleType": "medium"
        },
        "examples": [
          "No me parece correcto eso que dices, creo que deberías reconsiderarlo.",
          "Excelente punto! Me parece muy acertada tu observación al respecto."
        ]
      }
    ],
    "totalItems": 275,
    "createdAt": "2025-01-09T16:00:00Z"
  }
}
```

### Platform Integration Mock
```json
{
  "success": true,
  "data": {
    "platform": "twitter",
    "imported": 287,
    "languageHints": ["es", "en"],
    "status": "importing"
  }
}
```

### User Authentication
```json
{
  "user": {
    "id": "mock-user-123",
    "email": "test@example.com",
    "created_at": "2024-01-15T10:00:00Z"
  },
  "session": {
    "access_token": "mock-access-token"
  }
}
```

### API Health Check
```json
{
  "status": "ok",
  "services": {
    "database": "mock",
    "queue": "mock", 
    "ai": "mock"
  },
  "flags": {
    "mockMode": true
  }
}
```

## 🔧 Troubleshooting

### Issue: Tests still making real API calls
**Solution**: Verify environment variables are set correctly:
```bash
echo $ENABLE_MOCK_MODE  # Should be "true"
echo $NODE_ENV          # Should be "test"
```

### Issue: Frontend not using mocks
**Solution**: Check React environment variables:
```bash
echo $REACT_APP_ENABLE_MOCK_MODE  # Should be "true"
```

### Issue: Some services not mocked
**Solution**: Check the mock mode logs for specific service status:
```bash
# Look for logs like:
# 🎭 Mock Mode ENABLED - Using fake data for all external APIs
```

## 📝 Adding New Mock Services

To add mocking for a new external service:

1. **Backend**: Add mock generator to `src/config/mockMode.js`
2. **Frontend**: Add mock implementation to `src/lib/mockMode.js` 
3. **Tests**: Update setup files if needed
4. **Environment**: Add mock environment variables to `.env.test`

Example:
```javascript
// In mockMode.js
generateMockNewService() {
  return {
    apiCall: async () => ({ mock: true, data: 'mock-response' })
  };
}
```

---

**🎊 With this setup, you can develop and test the entire application without any real API keys or external dependencies!**